/*
 * Copyright (c) 2012 Brandon Jones, Colin MacKenzie IV
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */

/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/

(function(t){var e=1e-6,r=Array,n={};n.create=function(t){var e=new r(3);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):e[0]=e[1]=e[2]=0,e},n.createFrom=function(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i},n.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.equal=function(t,r){return t===r||e>Math.abs(t[0]-r[0])&&e>Math.abs(t[1]-r[1])&&e>Math.abs(t[2]-r[2])},n.add=function(t,e,r){return r&&t!==r?(r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},n.subtract=function(t,e,r){return r&&t!==r?(r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},n.multiply=function(t,e,r){return r&&t!==r?(r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},n.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},n.scale=function(t,e,r){return r&&t!==r?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r):(t[0]*=e,t[1]*=e,t[2]*=e,t)},n.normalize=function(t,e){e||(e=t);var r=t[0],n=t[1],i=t[2],a=Math.sqrt(r*r+n*n+i*i);return a?1===a?(e[0]=r,e[1]=n,e[2]=i,e):(a=1/a,e[0]=r*a,e[1]=n*a,e[2]=i*a,e):(e[0]=0,e[1]=0,e[2]=0,e)},n.cross=function(t,e,r){r||(r=t);var n=t[0],i=t[1],a=t[2],o=e[0],s=e[1],c=e[2];return r[0]=i*c-a*s,r[1]=a*o-n*c,r[2]=n*s-i*o,r},n.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},n.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.lerp=function(t,e,r,n){return n||(n=t),n[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n[2]=t[2]+r*(e[2]-t[2]),n},n.dist=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},n.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var i={};i.create=function(t){var e=new r(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},i.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.identity=function(t){return t||(t=i.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.transpose=function(t,e){if(!e||t===e){var r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=r,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=a,t[11]=t[14],t[12]=i,t[13]=o,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},i.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],u=t[8],h=t[9],l=t[10],m=t[11],d=t[12],f=t[13],v=t[14],g=t[15];return d*h*s*i-u*f*s*i-d*o*l*i+a*f*l*i+u*o*v*i-a*h*v*i-d*h*n*c+u*f*n*c+d*r*l*c-e*f*l*c-u*r*v*c+e*h*v*c+d*o*n*m-a*f*n*m-d*r*s*m+e*f*s*m+a*r*v*m-e*o*v*m-u*o*n*g+a*h*n*g+u*r*s*g-e*h*s*g-a*r*l*g+e*o*l*g},i.inverse=function(t,e){e||(e=t);var r,n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],h=t[7],l=t[8],m=t[9],d=t[10],f=t[11],v=t[12],g=t[13],p=t[14],x=t[15],b=n*c-i*s,M=n*u-a*s,w=n*h-o*s,y=i*u-a*c,T=i*h-o*c,E=a*h-o*u,A=l*g-m*v,R=l*p-d*v,_=l*x-f*v,S=m*p-d*g,C=m*x-f*g,P=d*x-f*p,I=b*P-M*C+w*S+y*_-T*R+E*A;return I?(r=1/I,e[0]=(c*P-u*C+h*S)*r,e[1]=(-i*P+a*C-o*S)*r,e[2]=(g*E-p*T+x*y)*r,e[3]=(-m*E+d*T-f*y)*r,e[4]=(-s*P+u*_-h*R)*r,e[5]=(n*P-a*_+o*R)*r,e[6]=(-v*E+p*w-x*M)*r,e[7]=(l*E-d*w+f*M)*r,e[8]=(s*C-c*_+h*A)*r,e[9]=(-n*C+i*_-o*A)*r,e[10]=(v*T-g*w+x*b)*r,e[11]=(-l*T+m*w-f*b)*r,e[12]=(-s*S+c*R-u*A)*r,e[13]=(n*S-i*R+a*A)*r,e[14]=(-v*y+g*M-p*b)*r,e[15]=(l*y-m*M+d*b)*r,e):null},i.toRotationMat=function(t,e){return e||(e=i.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},i.multiply=function(t,e,r){r||(r=t);var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],h=t[7],l=t[8],m=t[9],d=t[10],f=t[11],v=t[12],g=t[13],p=t[14],x=t[15],b=e[0],M=e[1],w=e[2],y=e[3];return r[0]=b*n+M*s+w*l+y*v,r[1]=b*i+M*c+w*m+y*g,r[2]=b*a+M*u+w*d+y*p,r[3]=b*o+M*h+w*f+y*x,b=e[4],M=e[5],w=e[6],y=e[7],r[4]=b*n+M*s+w*l+y*v,r[5]=b*i+M*c+w*m+y*g,r[6]=b*a+M*u+w*d+y*p,r[7]=b*o+M*h+w*f+y*x,b=e[8],M=e[9],w=e[10],y=e[11],r[8]=b*n+M*s+w*l+y*v,r[9]=b*i+M*c+w*m+y*g,r[10]=b*a+M*u+w*d+y*p,r[11]=b*o+M*h+w*f+y*x,b=e[12],M=e[13],w=e[14],y=e[15],r[12]=b*n+M*s+w*l+y*v,r[13]=b*i+M*c+w*m+y*g,r[14]=b*a+M*u+w*d+y*p,r[15]=b*o+M*h+w*f+y*x,r},i.multiplyVec3=function(t,e,r){r||(r=e);var n=e[0],i=e[1],a=e[2];return r[0]=t[0]*n+t[4]*i+t[8]*a+t[12],r[1]=t[1]*n+t[5]*i+t[9]*a+t[13],r[2]=t[2]*n+t[6]*i+t[10]*a+t[14],r},i.multiplyVec4=function(t,e,r){r||(r=e);var n=e[0],i=e[1],a=e[2],o=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,r},i.project=function(t,e,r){r||(r=e),i.multiplyVec4(t,e,r);var n=1/r[3];return r[0]*=n,r[1]*=n,r[2]*=n,r},i.rotateVec3=function(t,e,r){r||(r=e);var n=e[0],i=e[1],a=e[2];return r[0]=t[0]*n+t[4]*i+t[8]*a,r[1]=t[1]*n+t[5]*i+t[9]*a,r[2]=t[2]*n+t[6]*i+t[10]*a,r},i.translate=function(t,e,r){var n,i,a,o,s,c,u,h,l,m,d,f,v=e[0],g=e[1],p=e[2];return r&&t!==r?(n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],h=t[7],l=t[8],m=t[9],d=t[10],f=t[11],r[0]=n,r[1]=i,r[2]=a,r[3]=o,r[4]=s,r[5]=c,r[6]=u,r[7]=h,r[8]=l,r[9]=m,r[10]=d,r[11]=f,r[12]=n*v+s*g+l*p+t[12],r[13]=i*v+c*g+m*p+t[13],r[14]=a*v+u*g+d*p+t[14],r[15]=o*v+h*g+f*p+t[15],r):(t[12]=t[0]*v+t[4]*g+t[8]*p+t[12],t[13]=t[1]*v+t[5]*g+t[9]*p+t[13],t[14]=t[2]*v+t[6]*g+t[10]*p+t[14],t[15]=t[3]*v+t[7]*g+t[11]*p+t[15],t)},i.scale=function(t,e,r){var n=e[0],i=e[1],a=e[2];return r&&t!==r?(r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*a,r[9]=t[9]*a,r[10]=t[10]*a,r[11]=t[11]*a,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=a,t[9]*=a,t[10]*=a,t[11]*=a,t)},i.rotate=function(t,e,r,n){var i,a,o,s,c,u,h,l,m,d,f,v,g,p,x,b,M,w,y,T,E,A,R,_,S=r[0],C=r[1],P=r[2],I=Math.sqrt(S*S+C*C+P*P);return I?(1!==I&&(I=1/I,S*=I,C*=I,P*=I),i=Math.sin(e),a=Math.cos(e),o=1-a,s=t[0],c=t[1],u=t[2],h=t[3],l=t[4],m=t[5],d=t[6],f=t[7],v=t[8],g=t[9],p=t[10],x=t[11],b=S*S*o+a,M=C*S*o+P*i,w=P*S*o-C*i,y=S*C*o-P*i,T=C*C*o+a,E=P*C*o+S*i,A=S*P*o+C*i,R=C*P*o-S*i,_=P*P*o+a,n?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=s*b+l*M+v*w,n[1]=c*b+m*M+g*w,n[2]=u*b+d*M+p*w,n[3]=h*b+f*M+x*w,n[4]=s*y+l*T+v*E,n[5]=c*y+m*T+g*E,n[6]=u*y+d*T+p*E,n[7]=h*y+f*T+x*E,n[8]=s*A+l*R+v*_,n[9]=c*A+m*R+g*_,n[10]=u*A+d*R+p*_,n[11]=h*A+f*R+x*_,n):null},i.rotateX=function(t,e,r){var n=Math.sin(e),i=Math.cos(e),a=t[4],o=t[5],s=t[6],c=t[7],u=t[8],h=t[9],l=t[10],m=t[11];return r?t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[4]=a*i+u*n,r[5]=o*i+h*n,r[6]=s*i+l*n,r[7]=c*i+m*n,r[8]=a*-n+u*i,r[9]=o*-n+h*i,r[10]=s*-n+l*i,r[11]=c*-n+m*i,r},i.rotateY=function(t,e,r){var n=Math.sin(e),i=Math.cos(e),a=t[0],o=t[1],s=t[2],c=t[3],u=t[8],h=t[9],l=t[10],m=t[11];return r?t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=a*i+u*-n,r[1]=o*i+h*-n,r[2]=s*i+l*-n,r[3]=c*i+m*-n,r[8]=a*n+u*i,r[9]=o*n+h*i,r[10]=s*n+l*i,r[11]=c*n+m*i,r},i.rotateZ=function(t,e,r){var n=Math.sin(e),i=Math.cos(e),a=t[0],o=t[1],s=t[2],c=t[3],u=t[4],h=t[5],l=t[6],m=t[7];return r?t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=a*i+u*n,r[1]=o*i+h*n,r[2]=s*i+l*n,r[3]=c*i+m*n,r[4]=a*-n+u*i,r[5]=o*-n+h*i,r[6]=s*-n+l*i,r[7]=c*-n+m*i,r},i.frustum=function(t,e,r,n,a,o,s){s||(s=i.create());var c=e-t,u=n-r,h=o-a;return s[0]=2*a/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/u,s[6]=0,s[7]=0,s[8]=(e+t)/c,s[9]=(n+r)/u,s[10]=-(o+a)/h,s[11]=-1,s[12]=0,s[13]=0,s[14]=-(2*o*a)/h,s[15]=0,s},i.perspective=function(t,e,r,n,a){var o=r*Math.tan(t*Math.PI/360),s=o*e;return i.frustum(-s,s,-o,o,r,n,a)},i.ortho=function(t,e,r,n,a,o,s){s||(s=i.create());var c=e-t,u=n-r,h=o-a;return s[0]=2/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/h,s[11]=0,s[12]=-(t+e)/c,s[13]=-(n+r)/u,s[14]=-(o+a)/h,s[15]=1,s},i.lookAt=function(t,e,r,n){n||(n=i.create());var a,o,s,c,u,h,l,m,d,f,v=t[0],g=t[1],p=t[2],x=r[0],b=r[1],M=r[2],w=e[0],y=e[1],T=e[2];return v===w&&g===y&&p===T?i.identity(n):(l=v-w,m=g-y,d=p-T,f=1/Math.sqrt(l*l+m*m+d*d),l*=f,m*=f,d*=f,a=b*d-M*m,o=M*l-x*d,s=x*m-b*l,f=Math.sqrt(a*a+o*o+s*s),f?(f=1/f,a*=f,o*=f,s*=f):(a=0,o=0,s=0),c=m*s-d*o,u=d*a-l*s,h=l*o-m*a,f=Math.sqrt(c*c+u*u+h*h),f?(f=1/f,c*=f,u*=f,h*=f):(c=0,u=0,h=0),n[0]=a,n[1]=c,n[2]=l,n[3]=0,n[4]=o,n[5]=u,n[6]=m,n[7]=0,n[8]=s,n[9]=h,n[10]=d,n[11]=0,n[12]=-(a*v+o*g+s*p),n[13]=-(c*v+u*g+h*p),n[14]=-(l*v+m*g+d*p),n[15]=1,n)},i.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"};var a={};a.create=function(t){var e=new r(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):e[0]=e[1]=e[2]=e[3]=0,e},a.createFrom=function(t,e,n,i){var a=new r(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},a.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.equal=function(t,r){return t===r||e>Math.abs(t[0]-r[0])&&e>Math.abs(t[1]-r[1])&&e>Math.abs(t[2]-r[2])&&e>Math.abs(t[3]-r[3])},a.identity=function(t){return t||(t=a.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},a.calculateW=function(t,e){var r=t[0],n=t[1],i=t[2];return e&&t!==e?(e[0]=r,e[1]=n,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e):(t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t)},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},a.inverse=function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e&&t!==e?(e[0]=-t[0]*s,e[1]=-t[1]*s,e[2]=-t[2]*s,e[3]=t[3]*s,e):(t[0]*=-s,t[1]*=-s,t[2]*=-s,t[3]*=s,t)},a.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},a.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},a.normalize=function(t,e){e||(e=t);var r=t[0],n=t[1],i=t[2],a=t[3],o=Math.sqrt(r*r+n*n+i*i+a*a);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(o=1/o,e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e)},a.add=function(t,e,r){return r&&t!==r?(r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],t)},a.multiply=function(t,e,r){r||(r=t);var n=t[0],i=t[1],a=t[2],o=t[3],s=e[0],c=e[1],u=e[2],h=e[3];return r[0]=n*h+o*s+i*u-a*c,r[1]=i*h+o*c+a*s-n*u,r[2]=a*h+o*u+n*c-i*s,r[3]=o*h-n*s-i*c-a*u,r},a.multiplyVec3=function(t,e,r){r||(r=e);var n=e[0],i=e[1],a=e[2],o=t[0],s=t[1],c=t[2],u=t[3],h=u*n+s*a-c*i,l=u*i+c*n-o*a,m=u*a+o*i-s*n,d=-o*n-s*i-c*a;return r[0]=h*u+d*-o+l*-c-m*-s,r[1]=l*u+d*-s+m*-o-h*-c,r[2]=m*u+d*-c+h*-s-l*-o,r},a.scale=function(t,e,r){return r&&t!==r?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t)},a.toMat4=function(t,e){e||(e=i.create());var r=t[0],n=t[1],a=t[2],o=t[3],s=r+r,c=n+n,u=a+a,h=r*s,l=r*c,m=r*u,d=n*c,f=n*u,v=a*u,g=o*s,p=o*c,x=o*u;return e[0]=1-(d+v),e[1]=l+x,e[2]=m-p,e[3]=0,e[4]=l-x,e[5]=1-(h+v),e[6]=f+g,e[7]=0,e[8]=m+p,e[9]=f-g,e[10]=1-(h+d),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.slerp=function(t,e,r,n){n||(n=t);var i,a,o,s,c=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(c)>=1?(n!==t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),n):(i=Math.acos(c),a=Math.sqrt(1-c*c),.001>Math.abs(a)?(n[0]=.5*t[0]+.5*e[0],n[1]=.5*t[1]+.5*e[1],n[2]=.5*t[2]+.5*e[2],n[3]=.5*t[3]+.5*e[3],n):(o=Math.sin((1-r)*i)/a,s=Math.sin(r*i)/a,n[0]=t[0]*o+e[0]*s,n[1]=t[1]*o+e[1]*s,n[2]=t[2]*o+e[2]*s,n[3]=t[3]*o+e[3]*s,n))},a.fromRotationMatrix=function(t,e){e||(e=a.create());var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[7]-t[5])*r,e[1]=(t[2]-t[6])*r,e[2]=(t[3]-t[1])*r;else{var i=a.fromRotationMatrix.s_iNext=a.fromRotationMatrix.s_iNext||[1,2,0],o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var s=i[o],c=i[s];r=Math.sqrt(t[3*o+o]-t[3*s+s]-t[3*c+c]+1),e[o]=.5*r,r=.5/r,e[3]=(t[3*c+s]-t[3*s+c])*r,e[s]=(t[3*s+o]+t[3*o+s])*r,e[c]=(t[3*c+o]+t[3*o+c])*r}return e},a.identity=function(t){return t||(t=a.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},a.fromAngleAxis=function(t,e,r){r||(r=a.create());var n=.5*t,i=Math.sin(n);return r[3]=Math.cos(n),r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r},a.toAngleAxis=function(t,e){e||(e=t);var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){e[3]=2*Math.acos(t[3]);var n=1/Math.sqrt(r);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}else e[3]=0,e[0]=1,e[1]=0,e[2]=0;return e},a.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},t.vec3=n,t.mat4=i,t.quat4=a})(window),define("gw/glMatrix",function(){}),define("gw/Frustum",["./glMatrix"],function(){var t=function(){this.normal=vec3.create([0,0,0]),this.d=0};t.prototype.init=function(t,e,r){var n=[],i=[];vec3.subtract(e,t,n),vec3.subtract(r,t,i),vec3.cross(n,i,this.normal),vec3.normalize(this.normal),this.d=-vec3.dot(t,this.normal)},t.prototype.transform=function(t){var e=[this.normal[0],this.normal[1],this.normal[2],this.d];mat4.multiplyVec4(t,e),this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2],this.d=e[3]},t.prototype.intersectSphere=function(t,e){var r=vec3.dot(t,this.normal)+this.d;return r>e?1:-e>r?-1:0},t.prototype.distance=function(t){return t[0]*this.normal[0]+t[1]*this.normal[1]+t[2]*this.normal[2]+this.d},t.prototype.intersectBoundingBox=function(t){var e=(this.normal[0]>=0?1:0)|(this.normal[1]>=0?2:0)|(this.normal[2]>=0?4:0),r=7&~e;return this.distance(t.getCorner(r))>0?1:0>this.distance(t.getCorner(e))?-1:0};var e=function(){this.planes=[new t,new t,new t,new t,new t]};return e.prototype.compute=function(t){var e=mat4.create();mat4.inverse(t,e);var r=mat4.project(e,[-1,-1,-1,1]),n=mat4.project(e,[-1,1,-1,1]),i=mat4.project(e,[1,1,-1,1]),a=mat4.project(e,[1,-1,-1,1]);this.planes[0].init([0,0,0],r,n),this.planes[1].init([0,0,0],n,i),this.planes[2].init([0,0,0],i,a),this.planes[3].init([0,0,0],a,r),this.planes[4].init(r,n,i)},e.prototype.transform=function(t,e){var r=mat4.create();mat4.inverse(e,r),this.inverseTransform(t,r)},e.prototype.inverseTransform=function(t,e){for(var r=0;t.planes.length>r;r++){var n=t.planes[r],i=n.normal[0],a=n.normal[1],o=n.normal[2],s=n.d;n=this.planes[r],n.normal[0]=e[0]*i+e[1]*a+e[2]*o+e[3]*s,n.normal[1]=e[4]*i+e[5]*a+e[6]*o+e[7]*s,n.normal[2]=e[8]*i+e[9]*a+e[10]*o+e[11]*s,n.d=e[12]*i+e[13]*a+e[14]*o+e[15]*s}},e.prototype.containsSphere=function(t,e){for(var r=1,n=0;this.planes.length>n;n++){var i=this.planes[n].normal,a=t[0]*i[0]+t[1]*i[1]+t[2]*i[2]+this.planes[n].d;if(e>=a){if(-e>a)return-1;r=0}}return r},e.prototype.containsBoundingBox=function(t){for(var e=0;this.planes.length>e;e++){var r=this.planes[e],n=r.normal[0]>=0?t.max[0]:t.min[0],i=r.normal[1]>=0?t.max[1]:t.min[1],a=r.normal[2]>=0?t.max[2]:t.min[2],o=n*r.normal[0]+i*r.normal[1]+a*r.normal[2]+r.d;if(0>o)return!1}return!0},e.Plane=t,e}),define("gw/Numeric",[],function(){var t={};return t.lerp=function(t,e,r){return e+(r-e)*t},t.cubicInterpolation=function(t,e,r,n,i){var a=t*t,o=a*t,s=2*e[0]-2*n[0]+r[0]+i[0],c=2*e[1]-2*n[1]+r[1]+i[1],u=2*e[2]-2*n[2]+r[2]+i[2],h=-3*e[0]+3*n[0]-2*r[0]-i[0],l=-3*e[1]+3*n[1]-2*r[1]-i[1],m=-3*e[2]+3*n[2]-2*r[2]-i[2],d=vec3.create();return d[0]=s*o+h*a+r[0]*t+e[0],d[1]=c*o+l*a+r[1]*t+e[1],d[2]=u*o+m*a+r[2]*t+e[2],d},t.cubicInterpolationDerivative=function(t,e,r,n,i){var a=t*t,o=6*e[0]-6*n[0]+3*r[0]+3*i[0],s=6*e[1]-6*n[1]+3*r[1]+3*i[1],c=6*e[2]-6*n[2]+3*r[2]+3*i[2],u=-6*e[0]+6*n[0]-4*r[0]-2*i[0],h=-6*e[1]+6*n[1]-4*r[1]-2*i[1],l=-6*e[2]+6*n[2]-4*r[2]-2*i[2],m=vec3.create();return m[0]=o*a+u*t+r[0],m[1]=s*a+h*t+r[1],m[2]=c*a+l*t+r[2],m},t.map01=function(t,e,r){return e!=r?(t-e)/(r-e):0},t.mapLinear=function(e,r,n,i,a){return t.lerp(t.map01(e,r,n),i,a)},t.easeInQuad=function(t){return t*t},t.easeOutQuad=function(t){var e=t-1;return 1-e*e},t.easeInOutQuad=function(t){var e=t;return.5>e?(e+=e,e=.5*e*e):(e=e+e-2,e=.5*(1-e*e),e=.5+e),e},t.easeOutInQuad=function(t){var e=t;return.5>e?(e=e+e-1,e=.5*(1-e*e)):(e=e+e-1,e=.5*e*e,e=.5+e),e},t.toRadian=function(t){return t*Math.PI/180},t.toDegree=function(t){return 180*t/Math.PI},t.pointOnRay=function(t,e,r,n){return n||(n=vec3.create()),vec3.scale(e,r,n),vec3.add(n,t,n),n},t.lineIntersection=function(t,e,r,n,i,a,o,s){var c=(s-a)*(r-t)-(o-i)*(n-e);if(0==c)return[-1,-1];var u=(o-i)*(e-a)-(s-a)*(t-i),h=(r-t)*(e-a)-(n-e)*(t-i);return u/=c,h/=c,[u,h]},t.raySphereIntersection=function(t,e,r,n){var i=vec3.subtract(t,r,vec3.create()),a=2*vec3.dot(e,i),o=vec3.dot(i,i)-n*n,s=a*a-4*o;if(0>s)return-1;s=Math.sqrt(s);var c=(-a-s)/2,u=(-a+s)/2;if(c>u){var h=c;c=u,u=h}return 0>u?-1:0>c?u:c},t.roundNumber=function(t,e){var r=Math.round(t*Math.pow(10,e))/Math.pow(10,e);return r},t}),define("gw/CoordinateSystem",["./Numeric"],function(t){var e={radius:1,heightScale:1/6356752.3142,realEarthRadius:6356752.3142};return e.fromGeoTo3D=function(r,n){n||(n=Array(3));var i=t.toRadian(r[0]),a=t.toRadian(r[1]),o=Math.cos(a),s=r.length>2?e.heightScale*r[2]:0,c=e.radius+s;return n[0]=c*Math.cos(i)*o,n[1]=c*Math.sin(i)*o,n[2]=c*Math.sin(a),n},e.from3DToGeo=function(r,n){n||(n=Array(3));var i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),a=Math.atan2(r[1]/i,r[0]/i),o=Math.asin(r[2]/i);return n[0]=t.toDegree(a),n[1]=t.toDegree(o),n[2]=e.realEarthRadius*(i-e.radius),n},e.getLocalTransform=function(t,e){e||(e=mat4.create());var r=t[0]*Math.PI/180,n=t[1]*Math.PI/180,i=[Math.cos(r)*Math.cos(n),Math.sin(r)*Math.cos(n),Math.sin(n)],a=[-Math.sin(r),Math.cos(r),0],o=vec3.create();return vec3.cross(i,a,o),e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=0,e[4]=o[0],e[5]=o[1],e[6]=o[2],e[7]=0,e[8]=i[0],e[9]=i[1],e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.getLHVTransform=function(t,r){r||(r=mat4.create());var n=t[0]*Math.PI/180,i=t[1]*Math.PI/180,a=[Math.cos(n)*Math.cos(i),Math.sin(n)*Math.cos(i),Math.sin(i)],o=[-Math.sin(n),Math.cos(n),0],s=vec3.create();vec3.cross(a,o,s);var c=e.fromGeoTo3D(t);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=a[0],r[9]=a[1],r[10]=a[2],r[11]=0,r[12]=c[0],r[13]=c[1],r[14]=c[2],r[15]=1,r},e.getSideVector=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.getFrontVector=function(t,e){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e},e.getUpVector=function(t,e){return e[0]=t[8],e[1]=t[9],e[2]=t[10],e},e}),define("gw/RenderContext",["./Frustum","./Numeric","./CoordinateSystem","./glMatrix"],function(t,e,r){var n=function(e){this.shadersPath=e.shadersPath||"../shaders/",this.tileErrorTreshold=e.tileErrorTreshold||4,this.lighting=e.lighting||!1,this.continuousRendering=e.continuousRendering||!1,this.stats=null;var r=null;if(!e.canvas)throw"GlobWeb : no canvas in options";if(r="string"==typeof e.canvas?document.getElementById(e.canvas):e.canvas,!r instanceof HTMLCanvasElement)throw"GlobWeb : invalid canvas";for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,o=0;i.length>o&&null==a;++o)try{a=r.getContext(i[o],n.contextAttributes)}catch(s){}if(null==a)throw"GlobWeb : WebGL context cannot be initialized";if(e.backgroundColor){var c=e.backgroundColor;a.clearColor(c[0],c[1],c[2],c[3])}else a.clearColor(0,0,0,1);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.NONE),a.enable(a.DEPTH_TEST),a.enable(a.CULL_FACE),this.viewMatrix=mat4.create(),this.modelViewMatrix=mat4.create(),this.projectionMatrix=mat4.create(),this.gl=a,this.canvas=r,this.frustum=new t,this.worldFrustum=new t,this.localFrustum=new t,this.eyePosition=vec3.create(),this.eyeDirection=vec3.create(),this.minNear=1e-5,this.near=n.minNear,this.far=6,this.numActiveAttribArray=0,this.frameRequested=!1,this.fov=45,window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}())};return n.contextAttributes={},n.prototype.requestFrame=function(){this.frameRequested||(window.requestAnimationFrame(this.frame),this.frameRequested=!0)},n.prototype.updateViewDependentProperties=function(){var t=mat4.create();mat4.inverse(this.viewMatrix,t),vec3.set([0,0,0],this.eyePosition),mat4.multiplyVec3(t,this.eyePosition),vec3.set([0,0,-1],this.eyeDirection),mat4.rotateVec3(t,this.eyeDirection),mat4.perspective(this.fov,this.canvas.width/this.canvas.height,this.minNear,this.far,this.projectionMatrix),this.frustum.compute(this.projectionMatrix),this.worldFrustum.inverseTransform(this.frustum,this.viewMatrix),this.pixelSizeVector=this.computePixelSizeVector()},n.prototype.getXYRelativeToCanvas=function(t){var e=[];t.pageX||t.pageY?(e[0]=t.pageX,e[1]=t.pageY):(e[0]=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e[1]=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(var r=this.canvas;r;)e[0]-=r.offsetLeft,e[1]-=r.offsetTop,r=r.offsetParent;return e},n.prototype.computePixelSizeVector=function(t){var e=this.canvas.width,r=this.canvas.height,n=this.projectionMatrix,i=t||this.viewMatrix,a=.5*n[0]*e,o=.5*n[8]*e+.5*n[11]*e,s=[i[0]*a+i[2]*o,i[4]*a+i[6]*o,i[8]*a+i[10]*o],c=.5*n[5]*r,u=.5*n[9]*r+.5*n[11]*r,h=[i[1]*c+i[2]*u,i[5]*c+i[6]*u,i[9]*c+i[10]*u],l=n[11],m=n[15],d=[i[2]*l,i[6]*l,i[10]*l,i[14]*l+i[15]*m],f=.7071067811/Math.sqrt(vec3.dot(s,s)+vec3.dot(h,h));return d[0]*=f,d[1]*=f,d[2]*=f,d[3]*=f,d},n.prototype.get3DFromPixel=function(t,n){var i=2*(t/this.canvas.width)-1,a=-(2*(n/this.canvas.height)-1),o=mat4.create();mat4.multiply(this.projectionMatrix,this.viewMatrix,o),mat4.inverse(o);var s=mat4.multiplyVec4(o,[i,a,-1,1]);s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],mat4.inverse(this.viewMatrix,o);var c=[o[12],o[13],o[14]],u=vec3.create();vec3.subtract(s,c,u),vec3.normalize(u);var h=e.raySphereIntersection(c,u,[0,0,0],r.radius);if(h>=0){var l=e.pointOnRay(c,u,h);return l}return null},n.prototype.getPixelFrom3D=function(t,e,r){var n=mat4.create();mat4.multiply(this.projectionMatrix,this.viewMatrix,n);var i=[t,e,r,1];mat4.project(n,i);var a=Math.round(.5*(1+i[0])*this.canvas.width),o=Math.round(.5*(1-i[1])*this.canvas.height);return[a,o]},n.prototype.createNonPowerOfTwoTextureFromImage=function(t){var e=this.gl,r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r},n}),define("gw/Ray",["./glMatrix"],function(){var t=function(t,e){this.orig=t,this.dir=e};t.createFromEvent=function(e,r){var n=e.getXYRelativeToCanvas(r),i=2*(n[0]/e.canvas.width)-1,a=-(2*(n[1]/e.canvas.height)-1),o=mat4.create();mat4.multiply(e.projectionMatrix,e.viewMatrix,o),mat4.inverse(o);var s=mat4.multiplyVec4(o,[i,a,-1,1]);s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];var c=mat4.create();mat4.inverse(e.viewMatrix,c),vec3.set([0,0,0],e.eyePosition),mat4.multiplyVec3(c,e.eyePosition);var u=vec3.create(e.eyePosition),h=vec3.subtract(s,e.eyePosition,vec3.create());return vec3.normalize(h),new t(u,h)},t.Intersection=function(t){this.t=t,this.geometry=null},t.prototype.computePoint=function(t){var e=vec3.create();return vec3.scale(this.dir,t,e),vec3.add(e,this.orig),e},t.prototype.sphereIntersect=function(t,e){var r=vec3.subtract(this.orig,t,vec3.create()),n=2*vec3.dot(this.dir,r),i=vec3.dot(r,r)-e*e,a=n*n-4*i;if(0>a)return-1;a=Math.sqrt(a);var o=(-n-a)/2,s=(-n+a)/2;if(o>s){var c=o;o=s,s=c}return 0>s?-1:0>o?s:o};var e=1e-6;return t.prototype.triangleIntersectOptimized=function(r,n,i,a){var o=r[i]-r[n],s=r[i+1]-r[n+1],c=r[i+2]-r[n+2],u=r[a]-r[n],h=r[a+1]-r[n+1],l=r[a+2]-r[n+2],m=this.dir[1]*l-this.dir[2]*h,d=this.dir[2]*u-this.dir[0]*l,f=this.dir[0]*h-this.dir[1]*u,v=o*m+s*d+c*f;if(v>-e&&e>v)return null;var g=1/v,p=this.orig[0]-r[n],x=this.orig[1]-r[n+1],b=this.orig[2]-r[n+2],M=(p*m+x*d+b*f)*g;if(0>M||M>1)return null;var w=x*c-b*s,y=b*o-p*c,T=p*s-x*o,E=(this.dir[0]*w+this.dir[1]*y+this.dir[2]*T)*g;if(0>E||M+E>1)return null;var A=(u*w+h*y+l*T)*g;return A>=0?new t.Intersection(A):null},t.prototype.triangleIntersect=function(r,n,i){var a=vec3.subtract(n,r,vec3.create()),o=vec3.subtract(i,r,vec3.create()),s=vec3.cross(this.dir,o,vec3.create()),c=vec3.dot(a,s);if(c>-e&&e>c)return null;var u=1/c,h=vec3.subtract(this.orig,r,vec3.create()),l=vec3.dot(h,s)*u;if(0>l||l>1)return null;var m=vec3.cross(h,a,vec3.create()),d=vec3.dot(this.dir,m)*u;if(0>d||l+d>1)return null;var f=vec3.dot(o,m)*u;return new t.Intersection(f)},t}),define("gw/SceneGraph/Ray",["../Ray"],function(t){return t.prototype.nodeIntersect=function(t,e){for(var e=e||[],r=0;t.children.length>r;r++)t.children[r].intersectWith(this,e);for(var r=0;t.geometries.length>r;r++)this.geometryIntersect(t.geometries[r],e);return e.sort(function(t,e){return t.t-e.t}),e},t.prototype.lodNodeIntersect=function(t,e){var e=e||[];if(this.sphereIntersect(t.center,t.radius)>=0)if(t.children.length>0&&0==t.childToLoad)for(var r=0;t.children.length>r;r++)this.lodNodeIntersect(t.children[r],e);else for(var r=0;t.geometries.length>r;r++)this.geometryIntersect(t.geometries[r],e);return e},t.prototype.geometryIntersect=function(t,e){for(var r=t.mesh.vertices,n=0;r.length>n;n+=9){var i=this.triangleIntersectOptimized(r,n,n+3,n+6);i&&(i.geometry=t,e.push(i))}},t}),define("gw/SceneGraph/Navigation",["./Ray","../glMatrix"],function(t){var e=function(t,e){this.renderContext=t,this.pressX=-1,this.pressY=-1,this.lastMouseX=-1,this.lastMouseY=-1,this.pressedButton=-1,this.inverseViewMatrix=mat4.create(),this.minDistance=.005,this.maxDistance=1e4,this.center=[0,0,0],this.distance=3,this.heading=0,this.tilt=90,this.renderContext.near=.1,this.renderContext.far=5e3,this.node=e,this.computeViewMatrix()};return e.prototype.setupDefaultEventHandlers=function(){var t=this,e=this.renderContext.canvas;e.addEventListener("mousedown",function(e){return t.handleMouseDown(e||window.event)},!1),document.addEventListener("mouseup",function(e){return t.handleMouseUp(e||window.event)},!1),e.addEventListener("mousemove",function(e){return t.handleMouseMove(e||window.event)},!1),e.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},!1),e.addEventListener("DOMMouseScroll",function(e){return t.handleMouseWheel(e||window.event)},!1),e.addEventListener("mousewheel",function(e){return t.handleMouseWheel(e||window.event)},!1)},e.prototype.applyLocalRotation=function(t){mat4.rotate(t,this.heading*Math.PI/180,[0,0,1]),mat4.rotate(t,(90-this.tilt)*Math.PI/180,[1,0,0])},e.prototype.computeViewMatrix=function(){this.computeInverseViewMatrix(),mat4.inverse(this.inverseViewMatrix,this.renderContext.viewMatrix)},e.prototype.computeInverseViewMatrix=function(){mat4.identity(this.inverseViewMatrix),mat4.translate(this.inverseViewMatrix,this.center),this.applyLocalRotation(this.inverseViewMatrix),mat4.translate(this.inverseViewMatrix,[0,0,this.distance])},e.prototype.handleMouseWheel=function(t){return this.distance,this.distance*=void 0===t.wheelDelta?1+.1*t.detail:1+.1*(-t.wheelDelta/120),this.distance>this.maxDistance&&(this.distance=this.maxDistance),this.distance<this.minDistance&&(this.distance=this.minDistance),this.computeViewMatrix(),t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},e.prototype.handleMouseDown=function(t){return this.pressedButton=t.button,0==t.button||2==t.button?(this.pressX=t.clientX,this.pressY=t.clientY,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.previousEvent=t,!1):!0},e.prototype.pan=function(e){var r=t.createFromEvent(this.renderContext,e),n=t.createFromEvent(this.renderContext,this.previousEvent),i=vec3.create();vec3.subtract(r.orig,this.center,i),vec3.normalize(i);var a=vec3.dot(this.center,i),o=(a-vec3.dot(r.orig,i))/vec3.dot(r.dir,i),s=(a-vec3.dot(n.orig,i))/vec3.dot(n.dir,i),c=r.computePoint(o),u=n.computePoint(s),h=vec3.subtract(c,u,vec3.create());vec3.subtract(this.center,h),this.previousEvent=e,this.computeViewMatrix();var h=vec3.subtract(this.center,r.orig,vec3.create());vec3.normalize(h);var r=new t(r.orig,h),l=this.node.intersectWith(r);if(l.length>0){l.sort(function(t,e){return t.t-e.t});var m=r.computePoint(l[0].t);this.distance=l[0].t,this.center=m,this.computeViewMatrix()}},e.prototype.rotate=function(t,e){this.heading,this.tilt,this.heading+=.1*t,this.tilt+=.1*e,this.computeViewMatrix()},e.prototype.handleMouseMove=function(t){if(!(0>this.pressedButton)){var e=t.clientX-this.lastMouseX,r=t.clientY-this.lastMouseY,n=!1;if(0==this.pressedButton)this.pan(t),n=!0;else if(2==this.pressedButton){var e=t.clientX-this.lastMouseX,r=t.clientY-this.lastMouseY;this.rotate(e,r),n=!0}return this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,n}},e.prototype.handleMouseUp=function(t){return this.pressedButton=-1,0==t.button||2==t.button?(t.preventDefault(),!1):!0},e}),define("gw/Program",[],function(){var t=function(t){this.renderContext=t,this.glProgram=null,this.attributes={},this.uniforms={},this.numActiveAttribArray=0};return t.prototype.createShader=function(t,e){var r=this.renderContext.gl,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.log("Shader compilation error: "+r.getShaderInfoLog(n)),console.log(e),r.deleteShader(n),null)},t.prototype.createFromSource=function(t,e){var r=this.renderContext.gl,n=this.createShader(r.VERTEX_SHADER,t),i=this.createShader(r.FRAGMENT_SHADER,e);if(null==n||null==i)return!1;if(this.glProgram=r.createProgram(),r.attachShader(this.glProgram,n),r.attachShader(this.glProgram,i),r.linkProgram(this.glProgram),!r.getProgramParameter(this.glProgram,r.LINK_STATUS))return console.log("Program link error: "+r.getProgramInfoLog(this.glProgram)),r.deleteShader(n),r.deleteShader(i),r.deleteProgram(this.glProgram),this.glProgram=null,!1;var a=r.getProgramParameter(this.glProgram,r.ACTIVE_ATTRIBUTES);this.numActiveAttribArray=0;for(var o=0;a>o;++o){var s=r.getActiveAttrib(this.glProgram,o),c=r.getAttribLocation(this.glProgram,s.name);this.attributes[s.name]=c,c+1>this.numActiveAttribArray&&(this.numActiveAttribArray=c+1)}for(var u=r.getProgramParameter(this.glProgram,r.ACTIVE_UNIFORMS),o=0;u>o;++o){var h=r.getActiveUniform(this.glProgram,o);this.uniforms[h.name]=r.getUniformLocation(this.glProgram,h.name)}return!0},t.prototype.loadFromFile=function(t,e){var r=new XMLHttpRequest;r.open("get",this.renderContext.shadersPath+t,!1),r.send(null);var n=r.responseText;r.open("get",this.renderContext.shadersPath+e,!1),r.send(null);var i=r.responseText;return this.createFromSource(n,i)},t.prototype.apply=function(){var t=this.renderContext,e=t.gl;e.useProgram(this.glProgram);for(var r=t.numActiveAttribArray;this.numActiveAttribArray>r;r++)e.enableVertexAttribArray(r);for(var r=this.numActiveAttribArray;t.numActiveAttribArray>r;r++)e.disableVertexAttribArray(r);t.numActiveAttribArray=this.numActiveAttribArray},t}),define("gw/SceneGraph/Renderer",["../Program","../glMatrix"],function(t){var e=function(e,r){var n="	attribute vec3 vertex; \n	attribute vec2 tcoord; \n	uniform mat4 modelViewMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec2 texCoord; \n	\n	void main(void)  \n	{ \n		gl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z, 1.0); \n		texCoord = tcoord; \n	} \n	",i="	precision lowp float; \n	varying vec2 texCoord; \n	uniform vec4 diffuse; \n	uniform sampler2D texture;\n	\n	void main(void) \n	{ \n		gl_FragColor = diffuse * texture2D(texture, texCoord); \n	} \n	",a=e.gl;this.defaultTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.defaultTexture);
var o=new Uint8Array([255,255,255,255]);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,o),this.renderContext=e,this.program=new t(e),this.program.createFromSource(n,i),this.nodes=[],r&&this.nodes.push(r),this.matrixStack=[],e.minNear=.1,e.far=5e3,e.fov=60};return e.prototype.renderNode=function(t){var e=this.renderContext;if(e.gl,t.matrix){var r=mat4.create();mat4.set(this.matrixStack[this.matrixStack.length-1],r),mat4.multiply(r,t.matrix),this.matrixStack.push(r)}t.render(this),t.matrix&&(this.matrixStack.length=this.matrixStack.length-1)},e.prototype.render=function(){var t=this.renderContext,e=t.gl;e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.activeTexture(e.TEXTURE0),this.program.apply(),t.updateViewDependentProperties(),e.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,t.projectionMatrix),e.uniform1i(this.program.uniforms.texture,0),this.matrixStack.length=0,this.matrixStack.push(t.viewMatrix);for(var r=0;this.nodes.length>r;r++)this.renderNode(this.nodes[r]);this.postFrame&&this.postFrame()},e}),define("gw/BoundingBox",[],function(){var t=function(t,e){t&&(this.min=vec3.create(t)),e&&(this.max=vec3.create(e))};return t.prototype.extend=function(t,e,r){this.min?(this.min[0]>t&&(this.min[0]=t),this.min[1]>e&&(this.min[1]=e),this.min[2]>r&&(this.min[2]=r),t>this.max[0]&&(this.max[0]=t),e>this.max[1]&&(this.max[1]=e),r>this.max[2]&&(this.max[2]=r)):(this.min=vec3.create(),this.max=vec3.create(),this.min[0]=t,this.min[1]=e,this.min[2]=r,this.max[0]=t,this.max[1]=e,this.max[2]=r)},t.prototype.compute=function(t,e,r){this.min||(this.min=vec3.create(),this.max=vec3.create()),this.min[0]=t[0],this.min[1]=t[1],this.min[2]=t[2],this.max[0]=t[0],this.max[1]=t[1],this.max[2]=t[2];for(var n=r||3,i=e||t.length,a=n;i>a;a+=n)for(var o=0;3>o;o++)t[a+o]<this.min[o]&&(this.min[o]=t[a+o]),t[a+o]>this.max[o]&&(this.max[o]=t[a+o])},t.prototype.getCorner=function(t){return[1&t?this.max[0]:this.min[0],2&t?this.max[1]:this.min[1],4&t?this.max[2]:this.min[2]]},t.prototype.getCenter=function(){return[.5*(this.max[0]+this.min[0]),.5*(this.max[1]+this.min[1]),.5*(this.max[2]+this.min[2])]},t.prototype.getRadius=function(){var t=vec3.create();return vec3.subtract(this.max,this.min,t),.5*vec3.length(t)},t}),define("gw/SceneGraph/SceneGraph",["../BoundingBox"],function(t){var e={};e.Node=function(){this.geometries=[],this.children=[],this.matrix=null},t.prototype.merge=function(t){t.min&&t.max&&(this.min?(t.min[0]<this.min[0]&&(this.min[0]=t.min[0]),t.min[1]<this.min[1]&&(this.min[1]=t.min[1]),t.min[2]<this.min[2]&&(this.min[2]=t.min[2])):this.min=vec3.create(t.min),this.max?(t.max[0]>this.max[0]&&(this.max[0]=t.max[0]),t.max[1]>this.max[1]&&(this.max[1]=t.max[1]),t.max[2]>this.max[2]&&(this.max[2]=t.max[2])):this.max=vec3.create(t.max))},t.prototype.transform=function(t){for(var e=[],r=0;8>r;r++){var n=mat4.multiplyVec3(t,this.getCorner(r));e.push(n[0],n[1],n[2])}this.compute(e)},e.Node.prototype.computeBBox=function(){this.bbox=new t;for(var e=0;this.geometries.length>e;e++){var r=new t;r.compute(this.geometries[e].mesh.vertices),this.bbox.merge(r)}for(var e=0;this.children.length>e;e++)this.bbox.merge(this.children[e].computeBBox());return this.matrix&&this.bbox.transform(this.matrix),this.bbox},e.Node.prototype.intersectWith=function(t,e){return t.nodeIntersect(this,e)},e.Node.prototype.render=function(t){for(var e=0;this.children.length>e;e++)t.renderNode(this.children[e]);if(this.geometries.length>0){var r=t.renderContext,n=r.gl;n.uniformMatrix4fv(t.program.uniforms.modelViewMatrix,!1,t.matrixStack[t.matrixStack.length-1]);for(var e=0;this.geometries.length>e;e++){var i=this.geometries[e];i.material.bind(n,t.program,t),i.mesh.render(n,t.program)}}},e.Material=function(){this.diffuse=[1,1,1,1],this.texture=null},e.Material.prototype.bind=function(t,e,r){t.uniform4fv(e.uniforms.diffuse,this.diffuse),this.texture?this.texture.bind(t,r):t.bindTexture(t.TEXTURE_2D,r.defaultTexture)},e.Texture=function(t){this.glTexture=null,this.wrap=[WebGLRenderingContext.REPEAT,WebGLRenderingContext.REPEAT],this.image=new Image,this.image.onerror=function(){console.log("Cannot load texture "+t)},this.image.src=t};var r=function(t){return 0==(t&t-1)},n=function(t){--t;for(var e=1;32>e;e<<=1)t|=t>>e;return t+1};return e.Texture.prototype.bind=function(t){if(this.glTexture)t.bindTexture(t.TEXTURE_2D,this.glTexture);else if(this.image.complete&&this.image.width>0&&this.image.height>0){if(this.glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),r(this.image.width)&&r(this.image.height))t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image);else{var e=document.createElement("canvas");e.width=n(this.image.width),e.height=n(this.image.height);var i=e.getContext("2d");i.drawImage(this.image,0,0,e.width,e.height),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrap[0]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrap[1]),t.generateMipmap(t.TEXTURE_2D)}},e.Texture.prototype.dispose=function(t){this.glTexture&&t.gl.deleteTexture(this.glTexture)},e.Geometry=function(){this.material=null,this.mesh=null},e.Geometry.prototype.dispose=function(t){this.material.texture&&this.material.texture.dispose(t),this.mesh.dispose(t)},e.Mesh=function(){this.vertices=null,this.tcoords=null,this.glVertexBuffer=null,this.vbStride=0},e.Mesh.prototype.dispose=function(t){this.glVertexBuffer&&t.gl.deleteBuffer(this.glVertexBuffer)},e.Mesh.prototype.render=function(t,e){var r=this.vertices.length/3;if(!this.glVertexBuffer){var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);var i=5;this.vbStride=4*i;for(var a=new Float32Array(r*i),o=0;r>o;o++){var s=3*o,c=i*o;if(a[c]=this.vertices[s],a[c+1]=this.vertices[s+1],a[c+2]=this.vertices[s+2],this.tcoords){var u=2*o;a[c+3]=this.tcoords[u],a[c+4]=this.tcoords[u+1]}else a[c+3]=0,a[c+4]=0}t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),this.glVertexBuffer=n}t.bindBuffer(t.ARRAY_BUFFER,this.glVertexBuffer),t.vertexAttribPointer(e.attributes.vertex,3,t.FLOAT,!1,this.vbStride,0),t.vertexAttribPointer(e.attributes.tcoord,2,t.FLOAT,!1,this.vbStride,12),t.drawArrays(t.TRIANGLES,0,r)},e}),define("gw/SceneGraph/ColladaParser",["./SceneGraph"],function(t){var e=null,r={},n={},i={},a=null,o=null,s=function(t,e,r){var n=e+"[id='"+r.substring(1)+"']";return t?t.querySelector(n):doc.querySelector(n)},c=function(t,e){var r=t.getElementsByTagName(e);return r&&r.length>0?r[0]:null},u=function(t){for(var e=t.firstElementChild;e&&"asset"==e.nodeName;)e=e.nextElementSibling;return e},h=function(t){for(var e=[],r=t.textContent.trim().split(/\s+/),n=0;r.length>n;n++)e.push(parseFloat(r[n]));return e},l=function(e,r){var n,i=r.getAttribute("texture"),u=e.querySelector("newparam[sid='"+r.getAttribute("texture")+"']");if(u){var h=c(u,"source"),l=e.querySelector("newparam[sid='"+h.textContent.trim()+"']"),m=c(l,"init_from");n=s(a,"image","#"+m.textContent.trim())}else n=s(a,"image","#"+i);return new t.Texture(o+c(n,"init_from").textContent.trim())},m=function(e,n){for(var i=new t.Material,a=n.firstElementChild;a;){switch(a.nodeName){case"diffuse":var o=a.firstElementChild;"color"==o.nodeName?i.diffuse=h(o):"texture"==o.nodeName&&(i.texture=l(e,o));break;default:}a=a.nextElementSibling}r["#"+e.getAttribute("id")]=i},d=function(t){var e=c(t,"profile_COMMON");if(e)for(var r=c(t,"technique"),n=r.firstElementChild;n;){switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":m(t,n);break;default:}n=n.nextElementSibling}else console.log("ColladaParser : Only effect with profile common is supported.")},f=function(t){for(var e=u(t);e&&"material"==e.nodeName;){var n=c(e,"instance_effect"),i=s(a,"effect",n.getAttribute("url"));i&&(d(i),r["#"+e.getAttribute("id")]=r[n.getAttribute("url")]),e=e.nextElementSibling}},v=function(t,e){e.sources["#"+t.getAttribute("id")]=h(c(t,"float_array"))},g=function(t,e){var r=t.firstElementChild;e.sources["#"+t.getAttribute("id")]=e.sources[r.getAttribute("source")]},p=function(e,r){for(var n=null,i=null,a=0,o=-1,s=-1,c=[],u=[],h=e.firstElementChild;h;){switch(h.nodeName){case"input":var l=h.getAttribute("semantic");"VERTEX"==l?(n=r.sources[h.getAttribute("source")],o=parseInt(h.getAttribute("offset"))):"TEXCOORD"==l&&(i=r.sources[h.getAttribute("source")],s=parseInt(h.getAttribute("offset"))),a++;break;case"p":var m=h.textContent.trim().split(/\s+/),d=m.length/a;if(3==d)for(var f=0;d>f;f++){var v=parseInt(m[f*a+o]);if(c.push(n[3*v]),c.push(n[3*v+1]),c.push(n[3*v+2]),i){var g=parseInt(m[f*a+s]);u.push(i[2*g]),u.push(i[2*g+1])}}else console.log("ColladaParser : polygons with more 3 vertices not yet implemented")}h=h.nextElementSibling}var p=new t.Mesh;p.vertices=c,u&&(p.tcoords=u),r.meshes[e.getAttribute("material")]=p},x=function(e,r){for(var n=null,i=null,a=0,o=-1,s=-1,c=e.firstElementChild;c;){switch(c.nodeName){case"input":var u=c.getAttribute("semantic");"VERTEX"==u?(n=r.sources[c.getAttribute("source")],o=parseInt(c.getAttribute("offset"))):"TEXCOORD"==u&&(i=r.sources[c.getAttribute("source")],s=parseInt(c.getAttribute("offset"))),a++;break;case"p":for(var h=c.textContent.trim().split(/\s+/),l=[],m=i?[]:null,d=0;h.length/a>d;d++){var f=parseInt(h[d*a+o]);if(l[3*d]=n[3*f],l[3*d+1]=n[3*f+1],l[3*d+2]=n[3*f+2],i){var v=parseInt(h[d*a+s]);m[2*d]=i[2*v],m[2*d+1]=i[2*v+1]}}var g=new t.Mesh;g.vertices=l,m&&(g.tcoords=m),r.meshes[e.getAttribute("material")]=g}c=c.nextElementSibling}},b=function(t){for(var e={sources:{},meshes:{}},r=t.firstElementChild;r;){switch(r.nodeName){case"source":v(r,e);break;case"vertices":g(r,e);break;case"polylist":case"lines":console.log("ColladaParser : only triangles are implemented for mesh element");break;case"polygons":p(r,e);break;case"triangles":x(r,e)}r=r.nextElementSibling}return e},M=function(t){for(var e=u(t);e&&"geometry"==e.nodeName;){var r=c(e,"mesh");if(r){var i=b(r);i&&(n["#"+e.getAttribute("id")]=i)}else console.log("ColladaParser : only mesh geometry are supported.");e=e.nextElementSibling}},w=function(e){for(var a=new t.Node,o=e.firstElementChild;o;){switch(o.nodeName){case"node":a.children.push(w(o));break;case"instance_node":i.hasOwnProperty(o.getAttribute("url"))&&a.children.push(i[o.getAttribute("url")]);break;case"instance_geometry":if(n.hasOwnProperty(o.getAttribute("url")))for(var s=n[o.getAttribute("url")],c=o.getElementsByTagName("instance_material"),u=0;c.length>u;u++){var l=new t.Geometry;l.mesh=s.meshes[c[u].getAttribute("symbol")],l.material=r[c[u].getAttribute("target")],a.geometries.push(l)}break;case"rotate":case"translate":case"scale":case"skew":break;case"matrix":var m=h(o),d=mat4.create(m);mat4.transpose(d),a.matrix?mat4.multiply(a.matrix,d):a.matrix=d}o=o.nextElementSibling}return a},y=function(t){for(var e=u(t);e&&"node"==e.nodeName;){var r=w(e);r&&(i["#"+e.getAttribute("id")]=r),e=e.nextElementSibling}},T=function(r){var n=r.firstElementChild,i=n.firstElementChild;for(e=new t.Node;i;){switch(i.nodeName){case"node":var a=w(i);a&&e.children.push(a)}i=i.nextElementSibling}},E=function(t){o=t.documentURI.substr(0,t.documentURI.lastIndexOf("/")+1),a=t.documentElement;var r=a.getElementsByTagName("library_materials");r&&f(r[0]);var n=a.getElementsByTagName("library_geometries");n&&M(n[0]);for(var i=a.firstElementChild;i;){switch(i.nodeName){case"library_effects":break;case"library_images":break;case"library_nodes":y(i);break;case"library_visual_scenes":T(i);break;case"scene":}i=i.nextElementSibling}return e};return{parse:E}}),define("gw/SceneGraph/LODNode",["./ColladaParser","../BoundingBox"],function(t,e){var r=function(){this.modelPath="",this.center=null,this.radius=0,this.minRange=0,this.geometries=[],this.children=[],this.loaded=!1,this.loading=!1,this.imagesToLoad=0};r.prototype.unloadChildren=function(t){for(var e=0;this.children.length>e;e++)this.children[e].dispose(t)},r.prototype.dispose=function(t){if(this.loaded){for(var e=0;this.geometries.length>e;e++)this.geometries[e].dispose(t);this.geometries.length=0,this.unloadChildren(t),this.loaded=!1,this.imagesToLoad=0}};var n=function(t,e){for(var r=0;e.geometries.length>r;r++)t.push(e.geometries[r]);for(var r=0;e.children.length>r;r++)n(t,e.children[r])};r.Loader={freeRequests:[new XMLHttpRequest,new XMLHttpRequest],nodesToLoad:[],numRendered:0,numFrames:0},r.Loader.postFrame=function(){this.nodesToLoad.sort(function(t,e){return e.pixelSize-t.pixelSize});for(var t=0;this.nodesToLoad.length>t;t++)this.load(this.nodesToLoad[t].node);this.nodesToLoad.length=0};var i=function(t){t.imagesToLoad--,0==t.imagesToLoad&&(t.loading=!1,t.loaded=!0)};r.Loader.loadImages=function(t){t.imagesToLoad=t.geometries.length;for(var e=0;t.geometries.length>e;e++){var r=t.geometries[e].material.texture.image;r.complete?i(t):r.onload=function(){i(t)}}};var a=function(t){for(var e=0;t.length>e;e++)for(var r=t[e].material,n=t[e].mesh,i=e+1;t.length>i;)t[i].material==r?(n.vertices=n.vertices.concat(t[i].mesh.vertices),n.tcoords=n.tcoords.concat(t[i].mesh.tcoords),t.splice(i,1)):i++};return r.Loader.load=function(e){if(!e.loading&&!e.loaded){var r=this,i=this.freeRequests.pop();i&&(i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var o=t.parse(i.responseXML);n(e.geometries,o),a(e.geometries),r.loadImages(e),r.freeRequests.push(i)}},e.loading=!0,i.open("GET",e.modelPath),i.overrideMimeType("text/xml"),i.send())}},r.prototype.computeBBox=function(){this.bbox=new e;for(var t=0;this.geometries.length>t;t++){var r=new e;r.compute(this.geometries[t].mesh.vertices),this.bbox.merge(r)}for(var t=0;this.children.length>t;t++)this.bbox.merge(this.children[t].computeBBox());return this.matrix&&this.bbox.transform(this.matrix),this.bbox},r.prototype.intersectWith=function(t,e){return t.lodNodeIntersect(this,e)},r.prototype.render=function(t){if(0>t.renderContext.worldFrustum.containsSphere(this.center,this.radius))return this.unloadChildren(t.renderContext),void 0;if(this.loaded){var e=t.renderContext.pixelSizeVector,n=.25*Math.abs(this.radius/(this.center[0]*e[0]+this.center[1]*e[1]+this.center[2]*e[2]+e[3])),i=!0;if(n>this.minRange&&0!=this.children.length){for(var a=0;this.children.length>a;a++){var o=this.children[a];i&=o.loaded,o.loaded||o.loading||r.Loader.nodesToLoad.push({node:this.children[a],pixelSize:n})}if(i)for(var a=0;this.children.length>a;a++)t.renderNode(this.children[a])}if(this.minRange>n&&this.unloadChildren(t.renderContext),this.minRange>n||!i||0==this.children.length){var s=t.renderContext,c=s.gl;c.uniformMatrix4fv(t.program.uniforms.modelViewMatrix,!1,t.matrixStack[t.matrixStack.length-1]);for(var a=0;this.geometries.length>a;a++){var u=this.geometries[a];u.material.bind(c,t.program),u.mesh.render(c,t.program)}r.Loader.numRendered++}}else r.Loader.load(this)},r}),define("gw/SceneGraph/LODTreeLoader",["./LODNode"],function(t){var e=function(r,n){for(var i=new t,a=r.firstElementChild;a;){switch(a.nodeName){case"ModelPath":i.modelPath=n+a.textContent;break;case"Center":i.center=[parseFloat(a.getAttribute("x")),parseFloat(a.getAttribute("y")),parseFloat(a.getAttribute("z"))];break;case"Radius":i.radius=parseFloat(a.textContent);break;case"MinRange":i.minRange=parseFloat(a.textContent);break;case"Node":i.children.push(e(a,n))}a=a.nextElementSibling}return i},r=function(t){var r=t.documentElement,n=t.documentURI.substr(0,t.documentURI.lastIndexOf("/")+1),i=r.getElementsByTagName("Node");return i?e(i[0],n):null},n=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var t=r(n.responseXML);e&&e(t)}},n.open("GET",t),n.send()};return n}),requirejs.config({paths:{gw:"../../src"}}),require(["gw/RenderContext","gw/SceneGraph/Navigation","gw/SceneGraph/Renderer","gw/SceneGraph/SceneGraph","gw/SceneGraph/LODNode","gw/SceneGraph/LODTreeLoader"],function(t,e,r,n,i,a){var o=function(){if(null!=s){var t=0;u.numFrames>0&&(t=(i.Loader.numRendered/u.numFrames).toFixed(2)),s.innerHTML="FPS : "+u.numFrames+"<br># rendered node : "+t}i.Loader.numRendered=0,u.numFrames=0},s=document.getElementById("stats");window.setInterval(o,1e3);var c=document.getElementById("WebGLCanvas");c.width=window.innerWidth,c.height=window.innerHeight;var u=new t({canvas:c}),h=new n.Node,l=new e(u,h);l.setupDefaultEventHandlers();var m=new r(u,h);m.postFrame=function(){i.Loader.postFrame()};var d=function(t){l.center=vec3.create(t.center),l.distance=3*t.radius,l.computeViewMatrix(),h.children.push(t)};a("Data/Collada-ecef/Data/Tile_-009_-006/Tile_-009_-006.xml",d),a("Data/Collada-ecef/Data/Tile_-009_-007/Tile_-009_-007.xml",d),a("Data/Collada-ecef/Data/Tile_-009_-008/Tile_-009_-008.xml",d),a("Data/Collada-ecef/Data/Tile_-010_-006/Tile_-010_-006.xml",d),a("Data/Collada-ecef/Data/Tile_-010_-007/Tile_-010_-007.xml",d),a("Data/Collada-ecef/Data/Tile_-010_-008/Tile_-010_-008.xml",d);var f=function(){requestAnimationFrame(f),m&&m.render(),u.numFrames++};window.requestAnimationFrame(f)}),define("main",function(){});